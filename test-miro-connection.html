<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miro Connection Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .card { 
            background: white; 
            border-radius: 8px; 
            padding: 24px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .miro-logo {
            width: 40px;
            height: 40px;
            background: #FFD02F;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 16px;
        }
        input, button { 
            padding: 12px; 
            border-radius: 6px; 
            border: 1px solid #ddd; 
            margin: 8px 0; 
            width: 100%;
            box-sizing: border-box;
        }
        button { 
            background: #0066cc; 
            color: white; 
            cursor: pointer; 
            font-weight: 500;
        }
        button:hover { background: #0052a3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result { 
            padding: 16px; 
            border-radius: 6px; 
            margin-top: 16px; 
            white-space: pre-wrap;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 14px;
        }
        .success { background: #d4f4dd; border: 1px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #dc3545; color: #721c24; }
        .info { background: #d7ecff; border: 1px solid #007bff; color: #004085; }
        .loading { opacity: 0.7; }
        .board-info {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
        }
        .board-info h3 {
            margin: 0 0 12px 0;
            color: #333;
        }
        .open-board-btn {
            background: #FFD02F;
            color: black;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-weight: 600;
            margin-top: 12px;
            width: auto;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .open-board-btn:hover {
            background: #e6bb2a;
        }
    </style>
</head>
<body>
    <div class="card">
        <div class="miro-logo">M</div>
        <h1>Miro Board Connection Test</h1>
        <p>Test connection to Miro board: <strong>uXjVJOJdVHU=</strong></p>
        
        <div>
            <label for="token">Miro Access Token (optional - for full testing):</label>
            <input type="password" id="token" placeholder="Enter your Miro access token (leave empty to test without auth)">
        </div>
        
        <button onclick="testConnection()" id="testBtn">Test Connection</button>
        
        <div id="result"></div>
    </div>

    <script>
        const BOARD_ID = 'uXjVJOJdVHU=';
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
        }
        
        function showBoardInfo(boardData) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <div class="board-info">
                    <h3>âœ… Board Connection Successful!</h3>
                    <p><strong>Board Name:</strong> ${boardData.name || 'Unknown'}</p>
                    <p><strong>Board ID:</strong> ${BOARD_ID}</p>
                    <p><strong>Type:</strong> ${boardData.type || 'Unknown'}</p>
                    <p><strong>Last Modified:</strong> ${boardData.modifiedAt ? new Date(boardData.modifiedAt).toLocaleString() : 'Unknown'}</p>
                    <button class="open-board-btn" onclick="openInMiro()">
                        ðŸ”— Open Board in Miro
                    </button>
                </div>
            `;
        }
        
        function openInMiro() {
            window.open(`https://miro.com/app/board/${BOARD_ID}/`, '_blank');
        }
        
        async function testConnection() {
            const token = document.getElementById('token').value.trim();
            const testBtn = document.getElementById('testBtn');
            
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            testBtn.className = 'loading';
            
            showResult('Testing connection to Miro board...', 'info');
            
            try {
                if (!token) {
                    // Test without authentication - just check if the board URL is accessible
                    showResult(\`âš ï¸  No access token provided.

Testing basic board URL accessibility:
Board ID: \${BOARD_ID}
Board URL: https://miro.com/app/board/\${BOARD_ID}/

Without an access token, we cannot:
- Validate board permissions
- Get board information via API
- Create or modify board content

âœ… Board URL Format: Valid
âœ… Board ID Format: Valid (Base64 with = padding)

To fully test the connection:
1. Get a Miro access token from your Miro developer account
2. Go to: https://miro.com/app/settings/user-profile
3. Navigate to "Your apps" â†’ Create new app
4. Copy the access token and paste it above

The board URL appears to be properly formatted and should work if you have access to this board.\`, 'info');
                    
                    return;
                }
                
                // Test with access token
                const response = await fetch(\`https://api.miro.com/v2/boards/\${BOARD_ID}\`, {
                    method: 'GET',
                    headers: {
                        'Authorization': \`Bearer \${token}\`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const boardData = await response.json();
                    showBoardInfo(boardData);
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    let errorMessage = \`âŒ Connection failed (HTTP \${response.status})\n\n\`;
                    
                    switch(response.status) {
                        case 401:
                            errorMessage += 'Invalid access token. Please check your token and try again.';
                            break;
                        case 403:
                            errorMessage += \`You don't have permission to access board "\${BOARD_ID}".\\nPlease ensure you have read access to this board.\`;
                            break;
                        case 404:
                            errorMessage += \`Board "\${BOARD_ID}" not found.\\nPlease verify the board ID and that you have access to it.\`;
                            break;
                        default:
                            errorMessage += errorData.message || 'Unknown error occurred.';
                    }
                    
                    errorMessage += \`\\n\\nAPI Response: \${JSON.stringify(errorData, null, 2)}\`;
                    showResult(errorMessage, 'error');
                }
                
            } catch (error) {
                showResult(\`âŒ Network error: \${error.message}\\n\\nThis might be due to CORS restrictions when testing from a local file.\\nThe Miro API connection should work properly when integrated in the application.\`, 'error');
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Test Connection';
                testBtn.className = '';
            }
        }
        
        // Auto-test on load without token
        window.addEventListener('load', () => {
            setTimeout(testConnection, 500);
        });
    </script>
</body>
</html>